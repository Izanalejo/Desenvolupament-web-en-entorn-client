<!DOCTYPE html>
<html lang="ca">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Formulari de Contacte</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body
    style="
      background: linear-gradient(135deg, #009cad92, #00bbff);
      padding: 60px;
    "
    class="d-flex align-items-center justify-content-center"
  >
    <form
      id="formulariContacte"
      class="p-4 bg-white rounded-3 shadow-lg"
      style="max-width: 600px; width: 100%"
    >
      <h2 class="text-center mb-4">RA5-Formularios</h2>

      <div class="mb-3">
        <label for="nom" class="form-label">Nombre</label>
        <input
          type="text"
          class="form-control"
          id="nom"
          name="nom"
          placeholder="Escriu el teu nom"
        />
        <div
          id="error-nom"
          style="color: red; font-size: 0.875rem; margin-top: 0.25rem"
        ></div>
      </div>

      <div class="mb-3">
        <label for="email" class="form-label">Correo electronico</label>
        <input
          type="text"
          class="form-control"
          id="email"
          name="email"
          placeholder="exemple@correu.com"
        />
        <div
          id="error-email"
          style="color: red; font-size: 0.875rem; margin-top: 0.25rem"
        ></div>
      </div>

      <div class="mb-3">
        <label for="password" class="form-label">Contrase√±a</label>
        <input
          type="password"
          class="form-control"
          id="pass"
          name="pass"
          placeholder="Contrase√±a"
        />
      </div>

      <div class="mb-3">
        <label for="con_password" class="form-label">Repetir Contrase√±a</label>
        <input
          type="password"
          class="form-control"
          id="con_password"
          name="con_password"
          placeholder="Repetir Contrase√±a"
        />
      </div>

      <div class="mb-3">
        <label for="dni" class="form-label">DNI</label>
        <input
          type="text"
          class="form-control"
          id="dni"
          name="dni"
          placeholder="12345678X"
        />
      </div>

      <div class="mb-3">
        <label for="birthday" class="form-label">Fecha de nacimiento</label>
        <input
          type="text"
          class="form-control"
          id="birthday"
          name="birthday"
          placeholder="01/01/2001"
        />
      </div>

      <fieldset class="mb-3">
        <legend class="form-label">Genero</legend>
        <div class="form-check">
          <input
            type="radio"
            id="man"
            name="gender"
            value="man"
            class="form-check-input"
          />
          <label for="man" class="form-check-label">Hombre</label>
        </div>
        <div class="form-check">
          <input
            type="radio"
            id="woman"
            name="gender"
            value="woman"
            class="form-check-input"
          />
          <label for="woman" class="form-check-label">Mujer</label>
        </div>
        <div class="form-check">
          <input
            type="radio"
            id="altres"
            name="gender"
            value="altres"
            class="form-check-input"
          />
          <label for="other" class="form-check-label">No quiero decirlo</label>
        </div>
      </fieldset>

      <div class="mb-3">
        <label for="city" class="form-label">Ciudad de nacimiento</label>
        <select name="city" id="city" class="form-select">
          <option value="">--Selecciona--</option>
          <option value="barcelona">Barcelona</option>
          <option value="girona">Girona</option>
          <option value="lleida">Lleida</option>
          <option value="tarragona">Tarragona</option>
        </select>
      </div>

      <div class="d-flex justify-content-between">
        <button type="submit" class="btn btn-primary">Enviar</button>
        <button type="reset" class="btn btn-outline-secondary">Borrar</button>
      </div>
      <div class="mb-3 mt-3" id="error"></div>
    </form>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- JS personal -->
    <script>
      //llego al formulaio haciendo servir documents.forms
      let form2 = document.forms[0]; // <- Accedo al form que esta en la posicion 0

      //sean variables globales

      //Regex para validar los campos
      const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
      const nameRegex = /^[a-zA-Z √†√°√®√©√¨√≠√≤√≥√π√∫√Ä√Å√à√â√å√ç√í√ì√ô√öc√±√ë]+$/;
      const passwordRegex = /^[a-zA-Z √†√°√®√©√¨√≠√≤√≥√π√∫√Ä√Å√à√â√å√ç√í√ì√ô√öc√±√ë 0-9]+$/;
      const fechaRegex =
        /^(0[1-9]|[12][0-9]|3[01])\/(0[1-9]|1[0-2])\/(19\d{2}|20[0-1]\d|202[0-5])$/;
      let nom, email, dni, pass, con_password, gender, city, birthday, error;

      // --- VALIDACI√ìN EN BLUR DEL NOMBRE ---
      const inputNom = document.getElementById("nom");
      const errorNom = document.getElementById("error-nom");

      inputNom.addEventListener("blur", () => {
        if (!nameRegex.test(inputNom.value.trim())) {
          errorNom.innerHTML = "El nombre no es v√°lido ‚ùå";
        } else {
          errorNom.innerHTML = "";
        }
      });

      // --- VALIDACI√ìN EN BLUR DEL EMAIL ---
      const inputEmail = document.getElementById("email");
      const errorEmail = document.getElementById("error-email");

      inputEmail.addEventListener("blur", () => {
        if (!emailRegex.test(inputEmail.value.trim())) {
          errorEmail.innerHTML = "El correo no es v√°lido ‚ùå";
        } else {
          errorEmail.innerHTML = "";
        }
      });

      //----------------------------------------------------------------
      //Codigo proporcionado por chatgpt - forma de imprimir el "submit"
      form2.addEventListener("submit", (event) => {
        event.preventDefault(); // evita que se recargue la p√°gina
        //Variables para recoger los elementos enviados por formulario
        nom = form2.elements.nom.value;
        email = form2.elements.email.value;
        dni = form2.elements.dni.value;
        pass = form2.elements.pass.value;
        con_password = form2.elements.con_password.value;
        gender = form2.elements.gender.value;
        city = form2.elements.city.value;
        birthday = form2.elements.birthday.value;

        error = "";

        //VALIDAR CAMPOS VACIOS ----------------------------------
        if (
          nom === "" ||
          email === "" ||
          pass === "" ||
          con_password === "" ||
          dni === "" ||
          gender === "" ||
          city === "" ||
          birthday === ""
        ) {
          error += "Todos los campos son obligatorios ‚ö†Ô∏è <br>";
        }
        //VALIDAR NOMBRE --------------------------------------
        if (!nameRegex.test(nom)) {
          error += "El nombre no es v√°lido <br>";
        }

        //VALIDAR EMAIL---------------------------------------
        if (!emailRegex.test(email)) {
          error += "El correo no es valido <br>";
        }

        //VALIDAR CONTRASE√ëA----------------------------------
        if (!passwordRegex.test(pass)) {
          error += "La contrase√±a no es valida <br>";
        }
        if (pass.length < 8) {
          error +=
            "La contrase√±a tiene que tener como minimo 8 caracteres <br>";
        }
        if (pass !== con_password) {
          error += "La contrase√±a no coincide <br>";
        }

        //VALIDAR FECHA----------------------------------------
        if (!fechaRegex.test(birthday)) {
          error += "La fecha no es correcta <br>";
        }
        //VALIDAR DNI------------------------------------------
        if (!validarDNI()) {
          error += "El DNI no es valido <br>";
        }
        if (error !== "") {
          document.getElementById("error").innerHTML = error;
          document.getElementById("error").style.color = "red";
        } else {
          //FORMULARIO ENVIADO
          alert("Formulari enviat correctament üéâ");
          console.log("Nom: " + nom);
          console.log("Email: " + email);
          console.log("DNI: " + dni);
          console.log("Fecha de nacimiento: " + birthday);
          console.log("Genero: " + gender);
          console.log("Lugar de nacimiento: " + city);
          form2.reset(); // Neteja el formulari
          // Limpiar errores individuales
          errorNom.innerHTML = "";
          errorEmail.innerHTML = "";
        }
      });
      //----------------------------------------------------------------

      //VALIDAR DNI ----------------------------------------------------
      function validarDNI() {
        //no necesito pasar la variable dni ya que es global
        dni = dni.toUpperCase().trim();
        const dniregex = /^[0-9]{8}[A-Z]$/;

        if (!dniregex.test(dni)) {
          //detectar que la forma noes la correcta
          return false;
        }

        let num = parseInt(dni.slice(0, 8));
        let letter = dni[8];

        const dniletters = "TRWAGMYFPDXBNJZSQVHLCKE";
        let dniletter = dniletters[num % dniletters.length];

        return letter === dniletter;
      }

      function errorlog($message) {
        error.style.color = "white";
        error.style.backgroundColor = "red";
        error.innerHTML += $message;
      }
    </script>
  </body>
</html>
